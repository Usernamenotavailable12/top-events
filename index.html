<div id="root"></div>
<style>
    @font-face {
        font-family: "Noto Sans Ambassadori";
        font-style: normal;
        font-display: swap;
        src: url(https://usernamenotavailable12.github.io/Font-Repository/NotoSansAmbassadori-Regular.ttf);
    }

    body {
        margin: 0;
    }

    .card-block-container {
        display: flex;
        height: 76%;
    }

    .card-f-block,
    .card-s-block,
    .card-th-block {
        width: 100%;
        position: relative;
    }

    .card-f-block h3,
    .card-th-block h3 {
        margin: 0;
        color: #FFF;
        font-family: 'Noto Sans Ambassadori';
        font-size: 16px;
        font-style: normal;
        font-weight: 500;
        line-height: 20px;
        position: absolute;
        top: 68px;
        white-space: nowrap;
        max-width: 110px;
        overflow: hidden;
        text-overflow: ellipsis;
    }

    .card-f-block h3 {
        margin-left: 50%;
        transform: translateX(-50%);
    }

    .card-th-block h3 {
        margin-right: 50%;
        transform: translateX(50%);
    }

    .card-score-text {
        color: #F133FA;
        font-family: 'Noto Sans Ambassadori';
        font-size: 16px;
        font-style: normal;
        font-weight: 500;
        line-height: 20px;
        position: absolute;
        margin: 0 0 0 50%;
        bottom: 12px;
        transform: translateX(-50%);
    }

    .card-name-block p {
        color: #FFF;
        font-family: 'Noto Sans Ambassadori';
        font-size: 16px;
        font-style: normal;
        font-weight: 500;
        line-height: 20px;
        opacity: 0.6;
        margin: 0;
        margin-left: 50%;
        transform: translateX(-50%);
        white-space: nowrap;
        position: absolute;
        top: 32px;
    }

    .card-date-text {
        margin: 0;
        text-align: center;
        color: #FFF;
        font-family: 'Noto Sans Ambassadori';
        font-size: 16px;
        font-style: normal;
        font-weight: 500;
        line-height: 20px;
    }

    .card-f-block h3 {
        left: 0;
    }

    .card-th-block h3 {
        right: 0;
    }

    .carousel-container {
        align-self: stretch;
        background: linear-gradient(0deg, rgba(0, 0, 0, 0.60) 0%, rgba(0, 0, 0, 0.60) 100%),
            url("https://images.takeshape.io/5da2b4d5-59f6-412a-82c3-f6a272b532be/dev/a3ea1088-1319-4ec5-8e03-db7d39e86b5f/3764c27b1ea0023b90e190eabd49588a.webp") lightgray 0px -505.56px / 100% 441.509% no-repeat;

        border-radius: 0px;
        position: relative;
        width: 100%;
    }

    .carousel-track {
        display: flex;
        overflow-x: auto;
        padding: 24px;
        scroll-behavior: smooth;
        position: relative;
        user-select: none;
        gap: 12px;
    }

    .fade-left::before {
        content: '';
        position: absolute;
        top: 0;
        left: 0;
        width: 117px;
        height: 100%;
        flex-shrink: 0;
        background: linear-gradient(90deg, #121212 0%, rgba(18, 18, 18, 0.00) 88.89%);
        border-radius: 0px;
        z-index: 1;
        pointer-events: none;
        opacity: 1;
        transition: opacity 0.3s ease;
    }

    .fade-right::after {
        content: '';
        position: absolute;
        top: 0;
        right: 0;
        width: 117px;
        height: 100%;
        flex-shrink: 0;
        background: linear-gradient(270deg, #121212 0%, rgba(18, 18, 18, 0.00) 88.89%);
        border-radius: 16px;
        z-index: 1;
        pointer-events: none;
        opacity: 1;
        transition: opacity 0.3s ease;
    }

    .no-fade-left::before {
        opacity: 0;
    }

    .no-fade-right::after {
        opacity: 0;
    }

    .carousel-track .event-card:last-of-type {
        margin-right: 0px;
    }

    .carousel-track:first-child .event-card {
        margin-left: 0px;
    }

    .error-message {
        color: #dc2626;
        margin-left: auto;
        margin-right: auto;
        max-width: 80rem;
        padding-bottom: 1.5rem;
        padding-top: 1.5rem;
        text-align: center;
    }

    .event-card {
        backdrop-filter: blur(30px);
        background: rgba(255, 255, 255, 0.02);
        border-radius: 12px;
        box-shadow: 2px 2px 4px 2px rgba(0, 0, 0, 0.25);
        box-sizing: border-box;
        cursor: pointer;
        flex-shrink: 0;
        height: 208px;
        padding: 1rem;
        transition: box-shadow 0.2s ease;
        width: 376px;
        position: relative;
        z-index: 0;
    }

    .event-card:hover {
        box-shadow: 0 10px 15px rgba(0, 0, 0, 0.1);
    }

    .event-date {
        color: #4b5563;
        font-size: 0.875rem;
    }

    .event-title {
        color: #1f2937;
        font-size: 1.125rem;
        font-weight: 600;
        overflow: hidden;
        text-overflow: ellipsis;
        white-space: nowrap;
    }

    .nav-button-left {
        background-color: #1f2937;
        border: none;
        border-radius: 9999px;
        color: #ffffff;
        cursor: pointer;
        left: 0;
        padding: 0.5rem;
        position: absolute;
        top: 50%;
        transform: translateY(-50%);
        transition: background-color 0.2s ease;
        z-index: 2;
    }

    .nav-button-left:hover {
        background-color: #374151;
    }

    .nav-button-right {
        background-color: #1f2937;
        border: none;
        border-radius: 9999px;
        color: #ffffff;
        cursor: pointer;
        padding: 0.5rem;
        position: absolute;
        right: 0;
        top: 50%;
        transform: translateY(-50%);
        transition: background-color 0.2s ease;
        z-index: 2;
    }

    .nav-button-right:hover {
        background-color: #374151;
    }

    .no-events-message {
        color: #4b5563;
        margin-left: auto;
        margin-right: auto;
        max-width: 80rem;
        padding-bottom: 1.5rem;
        padding-top: 1.5rem;
        text-align: center;
    }

    .odd-item {
        align-items: center;
        background: #4D1A48;
        border-radius: 4px;
        color: #FFF;
        display: flex;
        font-family: 'Noto Sans Ambassadori';
        font-size: 16px;
        font-style: normal;
        font-weight: 500;
        justify-content: space-between;
        line-height: 20px;
        padding: 10px 12px;
        width: 100%;
    }

    .odd-item p {
        margin: 0;
    }


    .odds-row {
        display: flex;
        gap: 12px;
        justify-content: space-between;
    }

    .scrollbar-hide {
        scrollbar-width: none;
    }

    .scrollbar-hide::-webkit-scrollbar {
        display: none;
    }

    #app-container {
        background-color: transparent;
        min-height: 100vh;
    }

    @media (max-width: 768px) {
        .carousel-container {
            display: inline-flex;
            overflow: hidden;
            justify-content: flex-end;
            align-items: center;
            background: url(https://images.takeshape.io/5da2b4d5-59f6-412a-82c3-f6a272b532be/dev/cb93c5c1-791b-4edf-a146-00e17c27198a/ffa549b7395d5c97d05b17f87954629f.webp) lightgray 50% / cover no-repeat;
        }

        .carousel-track {
            padding: 6px 10px;
        }

        .event-card {
            width: 217px;
            height: 120px;
            aspect-ratio: 217/120;
            padding: 6px;
        }

        .card-block-container {
            height: 72%;
            display: block;
        }

        .card-f-block {
            width: 100%;
            position: relative;
            display: flex;
            justify-content: space-between;
        }

        .card-name-block p {
            position: inherit;
            margin: 0;
            transform: translateX(0);
            color: #FFF;
            opacity: 1;
            font-family: "Noto Sans Ambassadori";
            font-size: 10px;
            font-style: normal;
            font-weight: 400;
            line-height: 12px;
            max-width: 130px;
            overflow: hidden;
            text-overflow: ellipsis;
        }

        .card-date-text {
            color: #FFF;
            font-family: "Noto Sans Ambassadori";
            font-size: 10px;
            font-style: normal;
            font-weight: 400;
            line-height: 12px;
        }

        .card-s-block {
            position: inherit;
            width: auto;
            align-content: center;
            height: 100%;
            justify-content: space-evenly;
            display: flex;
            flex-direction: column;
            margin-left: 0;
        }

        .card-s-block h3 {
            margin: 0;
            color: #FFF;
            font-family: "Noto Sans Ambassadori";
            font-size: 12px;
            font-style: normal;
            font-weight: 400;
            line-height: 12px;
        }

        .card-score-text {
            position: inherit;
            margin: 0;
            transform: translateX(0);
            color: #F133FA;
            font-family: "Noto Sans Ambassadori";
            font-size: 14px;
            font-style: normal;
            font-weight: 400;
            line-height: 14px;
            padding: 4px;
            gap: 10px;
            border-radius: 4px;
            border: 1px solid #4D1A48;
        }

        .card-th-block {
            display: block;
            position: inherit;
            width: auto;
            align-content: center;
            height: 100%;
        }

        .card-s-th-container {
            height: 84%;
            width: 100%;
            display: inline-flex;
            justify-content: space-between;
        }

        .nav-button-left,
        .nav-button-right {
            display: none;
        }

        .odds-row {
            display: flex;
            gap: 4px;
            justify-content: space-between;
            width: 100%;
        }

        .odd-item {
            display: flex;
            width: 65px;
            box-sizing: border-box;
            padding: 8px 4px;
            justify-content: space-between;
            align-items: center;
            flex-shrink: 0;
        }

        .odd-item p {
            color: #FFF;
            font-family: "Noto Sans Ambassadori";
            font-size: 14px;
            font-style: normal;
            font-weight: 700;
            line-height: 16px;
        }
    }
</style>
<script src="https://cdn.jsdelivr.net/npm/react@18.2.0/umd/react.production.min.js"></script>
<script src="https://cdn.jsdelivr.net/npm/react-dom@18.2.0/umd/react-dom.production.min.js"></script>
<script src="https://cdn.jsdelivr.net/npm/@babel/standalone@7.22.9/babel.min.js"></script>
<script type="text/babel">
    const { useState, useEffect, useRef } = React;

    const formatDate = (dateString) => {
        const date = new Date(dateString);
        const month = date.getMonth() + 1;
        const day = date.getDate();
        const hour = date.getHours();
        const minute = date.getMinutes().toString().padStart(2, '0');
        return `${month}.${day}-${hour}:${minute}`;
    };

    const getOddsForMarket = (marketId, markets, odds) => {
        const market = markets.find(m => m.id === marketId);
        if (!market) return [];
        return market.oddIds.map(oddId => odds.find(o => o.id === oddId)).filter(Boolean);
    };

    const EventCard = ({ event, markets, odds, competitors, champs, categories }) => {
        const oddsData = getOddsForMarket(event.marketIds[0], markets, odds);
        const [isMobile, setIsMobile] = React.useState(window.innerWidth <= 768);

        useEffect(() => {
            const handleResize = () => {
                setIsMobile(window.innerWidth <= 768);
            };
            window.addEventListener('resize', handleResize);
            return () => window.removeEventListener('resize', handleResize);
        }, []);

        const handleClick = () => {
            const url = `/sportsbook/event/${event.id}`;
            window.parent.postMessage(
                { type: 'TMA_HREF', payload: url },
                '*'
            );
        };
        const competitorf = competitors.find(competitor => competitor.id === event.competitorIds[0]);
        const competitorsec = competitors.find(competitor => competitor.id === event.competitorIds[1]);

        if (isMobile) {
            return (
                <div className="event-card" onClick={handleClick}>
                    <div className="card-block-container">
                        <div className="card-f-block">
                            <span className="card-name-block">
                                <p>{categories.find(categorie => categorie.id === event.catId)?.name || ''}, {champs.find(champ => champ.id === event.champId)?.name || ''}</p>
                            </span>
                            <p className="card-date-text">{formatDate(event.startDate)}</p>
                        </div>
                        <div className="card-s-th-container">
                            <div className="card-s-block">
                                <h3 title={competitorf?.name || ''}>
                                    {competitorf?.name || ''}
                                </h3>
                                <h3 title={competitorsec?.name || ''}>
                                    {competitorsec?.name || ''}
                                </h3>
                            </div>
                            <div className="card-th-block">
                                <p className="card-score-text">+{event?.sc || ''}</p>
                            </div>
                        </div>
                    </div>
                    <div className="odds-container">
                        <div className="odds-row">
                            {oddsData.map(odd => (
                                <span key={odd.id} className="odd-item">
                                    <p>{odd.name}</p>
                                    <p>{Math.round(odd.price * 100) / 100}</p>
                                </span>
                            ))}
                        </div>
                    </div>
                </div>
            );
        }

        return (
            <div className="event-card" onClick={handleClick}>
                <div className="card-block-container">
                    <div className="card-f-block">
                        <h3 title={competitors.find(competitor => competitor.id === event.competitorIds[0])?.name || ''}>
                            {competitors.find(competitor => competitor.id === event.competitorIds[0])?.name || ''}
                        </h3>
                    </div>
                    <div className="card-s-block">
                        <p className="card-date-text">{formatDate(event.startDate)}</p>
                        <span className="card-name-block">
                            <p>{categories.find(categorie => categorie.id === event.catId)?.name || ''}, {champs.find(champ => champ.id === event.champId)?.name || ''}</p>
                        </span>
                        <p className="card-score-text">+{event?.sc || ''}</p>
                    </div>
                    <div className="card-th-block">
                        <h3 title={competitors.find(competitor => competitor.id === event.competitorIds[1])?.name || ''}>
                            {competitors.find(competitor => competitor.id === event.competitorIds[1])?.name || ''}
                        </h3>
                    </div>
                </div>
                <div className="odds-container">
                    <div className="odds-row">
                        {oddsData.map(odd => (
                            <span key={odd.id} className="odd-item">
                                <p>{odd.name}</p>
                                <p>{Math.round(odd.price * 100) / 100}</p>
                            </span>
                        ))}
                    </div>
                </div>
            </div>
        );
    };

    const Carousel = ({ data, error }) => {
        const carouselRef = useRef(null);
        const [showFadeLeft, setShowFadeLeft] = useState(true);
        const [showFadeRight, setShowFadeRight] = useState(true);
        const isDragging = useRef(false);
        const startX = useRef(0);
        const scrollLeftStart = useRef(0);

        const checkScroll = () => {
            if (carouselRef.current) {
                const { scrollLeft, scrollWidth, clientWidth } = carouselRef.current;
                setShowFadeLeft(scrollLeft > 0);
                setShowFadeRight(scrollLeft < scrollWidth - clientWidth - 1);
            }
        };

        useEffect(() => {
            const carousel = carouselRef.current;
            if (carousel) {
                checkScroll();
                carousel.addEventListener('scroll', checkScroll);
                return () => carousel.removeEventListener('scroll', checkScroll);
            }
        }, [data]);

        const scrollLeft = () => {
            if (carouselRef.current) {
                carouselRef.current.scrollBy({ left: -388, behavior: 'smooth' });
            }
        };

        const scrollRight = () => {
            if (carouselRef.current) {
                carouselRef.current.scrollBy({ left: 388, behavior: 'smooth' });
            }
        };

        const handleMouseDown = (e) => {
            if (carouselRef.current) {
                isDragging.current = true;
                startX.current = e.pageX;
                scrollLeftStart.current = carouselRef.current.scrollLeft;
                carouselRef.current.style.cursor = 'grabbing';
                carouselRef.current.style.scrollBehavior = 'auto';
                carouselRef.current.style.scrollSnapType = 'none';
            }
        };

        const handleMouseMove = (e) => {
            if (!isDragging.current || !carouselRef.current) return;
            e.preventDefault();
            const x = e.pageX;
            const walk = x - startX.current;
            carouselRef.current.scrollLeft = scrollLeftStart.current - walk;
        };

        const handleMouseUp = () => {
            if (carouselRef.current) {
                isDragging.current = false;
                carouselRef.current.style.cursor = 'grab';
                carouselRef.current.style.scrollBehavior = 'smooth';
            }
        };

        const handleMouseLeave = () => {
            if (carouselRef.current) {
                isDragging.current = false;
                carouselRef.current.style.cursor = 'grab';
                carouselRef.current.style.scrollBehavior = 'smooth';
            }
        };

        if (error) {
            return (
                <div className="error-message">
                    <p>Error fetching events: {error}</p>
                </div>
            );
        }

        if (!data || !data.events || data.events.length === 0) {
            return (
                <div className="no-events-message">
                    <p>No events available</p>
                </div>
            );
        }

        return (
            <div className={`carousel-container fade-left fade-right ${showFadeLeft ? '' : 'no-fade-left'} ${showFadeRight ? '' : 'no-fade-right'}`}>
                <div
                    ref={carouselRef}
                    className="carousel-track scrollbar-hide"
                    onMouseDown={handleMouseDown}
                    onMouseMove={handleMouseMove}
                    onMouseUp={handleMouseUp}
                    onMouseLeave={handleMouseLeave}
                    style={{ cursor: 'grab' }}
                >
                    {data.events.map(event => (
                        <EventCard
                            key={event.id}
                            event={event}
                            markets={data.markets}
                            odds={data.odds}
                            competitors={data.competitors}
                            champs={data.champs}
                            categories={data.categories}
                        />
                    ))}
                </div>
                <button onClick={scrollLeft} className="nav-button-left">←</button>
                <button onClick={scrollRight} className="nav-button-right">→</button>
            </div>
        );
    };

    const App = () => {
        const [data, setData] = useState(null);
        const [error, setError] = useState(null);

        useEffect(() => {
            const fetchData = async () => {
                try {
                    const urlParams = new URLSearchParams(window.location.search);
                    const culture = urlParams.get('culture') || 'ka-GE';

                    const response = await fetch(
                        `https://sb2frontend-altenar2.biahosted.com/api/widget/GetTopEvents?culture=${culture}&integration=ambassadoribet`,
                        {
                            method: 'GET',
                            headers: {
                                'Accept': 'application/json'
                            }
                        }
                    );

                    if (!response.ok) {
                        throw new Error(`HTTP error! Status: ${response.status}`);
                    }

                    const result = await response.json();
                    setData(result);
                } catch (err) {
                    setError(err.message);
                }
            };

            fetchData();
        }, []);

        return (
            <div id="app-container">
                <Carousel data={data} error={error} />
            </div>
        );
    };

    ReactDOM.render(<App />, document.getElementById('root'));
</script>
