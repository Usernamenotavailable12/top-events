
<script src="https://cdn.jsdelivr.net/npm/react@18.2.0/umd/react.production.min.js"></script>
<script src="https://cdn.jsdelivr.net/npm/react-dom@18.2.0/umd/react-dom.production.min.js"></script>
<script src="https://cdn.jsdelivr.net/npm/@babel/standalone@7.22.9/babel.min.js"></script>
<script src="https://cdn.tailwindcss.com"></script>
<div id="root"></div>
<script type="text/babel">
  const { useState, useEffect, useRef } = React;

  const formatDate = (dateString) => {
    const options = { month: 'short', day: 'numeric', year: 'numeric', hour: 'numeric', minute: '2-digit', hour12: true };
    return new Date(dateString).toLocaleString('en-US', options);
  };

  const getOddsForMarket = (marketId, markets, odds) => {
    const market = markets.find(m => m.id === marketId);
    if (!market) return [];
    return market.oddIds.map(oddId => odds.find(o => o.id === oddId)).filter(Boolean);
  };

  const EventCard = ({ event, markets, odds }) => {
    const oddsData = getOddsForMarket(event.marketIds[0], markets, odds);

    const handleClick = () => {
      const url = `/sportsbook/event/${event.id}`;
      window.parent.postMessage(
        { type: 'TMA_HREF', payload: url },
        '*' 
      );
    };

    return (
      <div
        className="flex-shrink-0 w-80 bg-white rounded-lg shadow-md p-4 mx-2 cursor-pointer hover:shadow-lg transition snap-center"
        onClick={handleClick}
      >
        <h3 className="text-lg font-semibold text-gray-800 truncate">{event.name}</h3>
        <p className="text-sm text-gray-600">{formatDate(event.startDate)}</p>
        <div className="mt-2">
          <div className="flex justify-between mt-1">
            {oddsData.map(odd => (
              <span key={odd.id} className="text-sm text-gray-600">
                {odd.name}: {odd.price}
              </span>
            ))}
          </div>
        </div>
      </div>
    );
  };

  const Carousel = ({ data, error }) => {
    const carouselRef = useRef(null);

    const scrollLeft = () => {
      if (carouselRef.current) {
        carouselRef.current.scrollBy({ left: -320, behavior: 'smooth' });
      }
    };

    const scrollRight = () => {
      if (carouselRef.current) {
        carouselRef.current.scrollBy({ left: 320, behavior: 'smooth' });
      }
    };

    if (error) {
      return (
        <div className="max-w-7xl mx-auto py-6 text-center">
          <p className="text-red-600">Error fetching events: {error}</p>
        </div>
      );
    }

    if (!data || !data.events || data.events.length === 0) {
      return (
        <div className="max-w-7xl mx-auto py-6 text-center">
          <p className="text-gray-600">No events available</p>
        </div>
      );
    }

    return (
      <div className="relative max-w-7xl mx-auto py-6">
        <div
          ref={carouselRef}
          className="flex overflow-x-auto snap-x snap-mandatory scrollbar-hide"
          style={{ scrollBehavior: 'smooth' }}
        >
          {data.events.map(event => (
            <EventCard
              key={event.id}
              event={event}
              markets={data.markets}
              odds={data.odds}
            />
          ))}
        </div>
        <button
          onClick={scrollLeft}
          className="absolute left-0 top-1/2 transform -translate-y-1/2 bg-gray-800 text-white rounded-full p-2 hover:bg-gray-700"
        >
          ←
        </button>
        <button
          onClick={scrollRight}
          className="absolute right-0 top-1/2 transform -translate-y-1/2 bg-gray-800 text-white rounded-full p-2 hover:bg-gray-700"
        >
          →
        </button>
      </div>
    );
  };

  // App Component
  const App = () => {
    const [data, setData] = useState(null);
    const [error, setError] = useState(null);

    useEffect(() => {
      const fetchData = async () => {
        try {
          const response = await fetch(
            'https://sb2frontend-altenar2.biahosted.com/api/widget/GetTopEvents?culture=ka-GE&integration=ambassadoribet',
            {
              method: 'GET',
              headers: {
                'Accept': 'application/json'
              }
            }
          );

          if (!response.ok) {
            throw new Error(`HTTP error! Status: ${response.status}`);
          }

          const result = await response.json();
          setData(result);
        } catch (err) {
          setError(err.message);
        }
      };

      fetchData();
    }, []);

    return (
      <div className="min-h-screen bg-gray-100">
        <Carousel data={data} error={error} />
      </div>
    );
  };

  ReactDOM.render(<App />, document.getElementById('root'));
</script>

<style>
  body {
    margin: 0;
    padding: 0;;
  }
  .scrollbar-hide::-webkit-scrollbar {
    display: none;
  }
  .scrollbar-hide {
    scrollbar-width: none;
  }
</style>
